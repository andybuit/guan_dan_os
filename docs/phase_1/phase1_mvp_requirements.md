# 掼蛋全球平台 - Phase 1 MVP 需求文档

**项目名称**: Guandan Global Platform Phase 1 MVP  
**版本**: 1.0  
**发布日期**: 2025年12月  
**目标用户**: 海外华人、掼蛋爱好者（初期10万DAU）  
**开发周期**: 4-5个月  
**技术栈**: React (Web) + React Native (Mobile) + AWS Lambda + DynamoDB  

---

## 1. 项目概述

### 1.1 目标与愿景

**愿景**: 成为全球最大的在线掼蛋游戏平台，让海外华人随时随地享受传统掼蛋游戏的乐趣。

**Phase 1 目标**:
- 快速上线核心游戏功能，验证市场需求
- 建立用户基础：10万 DAU（日活跃用户）
- 实现基础变现：游戏币充值（支付宝/信用卡）
- 准备 Phase 2：Web3 基础设施就位

**成功指标 (KPI)**:
- 下载量: 50万+ (前3个月)
- DAU: 10万+ (第5个月)
- 付费率 (ARPU): $5-8/月/用户
- 月留存率 (M1): 40%+
- 日玩家会话数: 平均 30分钟/天

### 1.2 范围限定 (MVP不包含)

**Phase 1 MVP 明确不包含**:
- ❌ 区块链集成 (推迟至 Phase 2)
- ❌ Token ($PLAY, $GUAN) 发行
- ❌ NFT 功能
- ❌ 多语言支持 (仅中文简/繁)
- ❌ AI 对手 (后续补充)
- ❌ 高级社交功能 (语音/视频通话)
- ❌ 赛事/锦标赛系统

---

## 2. 用户故事与功能需求

### 2.1 核心用户角色

#### 角色 1: 休闲玩家 (70%)
- **描述**: 工作之余消遣，每周玩5-10局，偶尔充值
- **动机**: 娱乐、社交、回忆乡愁
- **典型行为**: 午间休息玩1-2局，周末与朋友约战

#### 角色 2: 重度玩家 (20%)
- **描述**: 每天多次游玩，频繁充值，关注排名
- **动机**: 竞技、赚取游戏币兑换奖励
- **典型行为**: 每天玩20+局，追求高排名

#### 角色 3: 社交玩家 (10%)
- **描述**: 主要目的是与朋友/家人互动
- **动机**: 保持联系、集体游戏体验
- **典型行为**: 创建私房间邀请好友

---

### 2.2 核心功能需求

#### US-1: 用户认证与账户管理

**功能描述**: 用户可通过邮箱/手机号注册、登录、管理个人资料

**验收标准**:
- [ ] 支持邮箱注册 (邮箱验证链接)
- [ ] 支持手机号注册 (短信OTP验证)
- [ ] 支持第三方登录 (微信/微博 OAuth)
- [ ] 密码重置流程
- [ ] 个人资料编辑 (昵称、头像、简介)
- [ ] 账户安全设置 (修改密码、绑定手机)
- [ ] 账户注销选项
- [ ] 自动登出 (24小时无活动)

**技术要求**:
- JWT 令牌，15分钟过期，可刷新
- 密码加密: bcrypt (rounds=12)
- 使用 AWS Cognito 或自建 Lambda 服务

---

#### US-2: 匹配对手与创建房间

**功能描述**: 用户可快速匹配对手或创建私房与朋友游戏

**功能清单**:

##### 2.2.1 快速匹配
- [ ] 点击"快速开始"，系统自动分配3个对手
- [ ] 基于玩家等级/胜率进行匹配 (±10级范围)
- [ ] 显示匹配进度 (1秒内显示"寻找对手中...")
- [ ] 超过30秒未匹配则给予补偿 (免费游戏币)
- [ ] 玩家可随时取消匹配 (返回大厅)

##### 2.2.2 私房创建
- [ ] 创建房间 (选择玩家数、底注、局数)
- [ ] 生成房间号 (6位数字)
- [ ] 邀请朋友 (分享链接/复制房间号)
- [ ] 房间信息显示 (在线人数、局数、底注)
- [ ] 房主权限 (开始游戏、踢出玩家、解散房间)
- [ ] 密码保护选项 (可选)

**性能要求**:
- 匹配延迟: <5秒 (P95)
- 房间创建: <1秒
- 支持 10,000 并发房间

**技术方案**:
- 使用 WebSocket 实时通信
- Redis 缓存玩家等级/胜率数据
- DynamoDB 存储房间状态

---

#### US-3: 游戏核心流程

**功能描述**: 实现掼蛋游戏的完整对战流程

##### 3.1 游戏阶段

**第一阶段: 游戏准备**
- [ ] 显示4位玩家的昵称、等级、头像
- [ ] 显示本局底注 (如 20金币/注)
- [ ] 倒计时 10 秒开始游戏 (玩家可延迟进入)
- [ ] 显示房间内其他玩家的准备状态

**第二阶段: 洗牌与发牌**
- [ ] 动画显示洗牌过程
- [ ] 动画显示发牌过程 (每位玩家获得13张牌)
- [ ] 预留2张牌作为底牌 (显示在中央，暂不可见)

**第三阶段: 出牌顺序决定**
- [ ] 随机选择先手玩家 (或基于上局排名)
- [ ] 显示出牌顺序: 玩家1 → 玩家2 → 玩家3 → 玩家4 → 玩家1...
- [ ] 高亮显示当前出牌者

**第四阶段: 出牌与跟牌**
- [ ] 玩家手牌显示在下方 (按牌型自动分类)
- [ ] 出牌规则提示 (合法的出牌组合)
- [ ] 出牌倒计时: 30秒 (超时自动过牌)
- [ ] 支持的出牌方式:
  - 单牌
  - 对子
  - 三张 / 炸弹
  - 顺子 (5张及以上连续牌)
  - 顺对 (连续对子)
  - 船牌 (3+1或3+2)
  - 飞机 (连续三张)
  - 五步 (连续三张+连续对子)
- [ ] 其他玩家可选择 "跟" 或 "过"
- [ ] 一旦有玩家跟牌，后续玩家必须更大

**第五阶段: 结算**
- [ ] 统计各玩家剩余手牌数
- [ ] 计算加倍关系 (压级/升级)
- [ ] 显示本局输赢金币
- [ ] 更新玩家积分/等级
- [ ] 显示游戏统计 (出牌次数、跟牌次数、平均出牌时间)

**第六阶段: 继续游戏**
- [ ] 显示本局统计和积分
- [ ] 按钮: "再来一局" / "返回大厅"
- [ ] 如为私房，显示剩余局数

##### 3.2 游戏规则细节

| 规则项 | 说明 |
|--------|------|
| **玩家数** | 4人 (固定) |
| **牌数** | 52张标准扑克牌 + 2张王牌 = 54张 |
| **每人初始** | 13张 |
| **底牌** | 2张 (通常结算时加入) |
| **出牌顺序** | 顺时针 (可配置) |
| **出牌超时** | 30秒自动过牌 |
| **最小组合** | 单牌/对子/三张/炸弹 |
| **级数制度** | 2-A (A为1，不为14) |
| **压级规则** | 末位玩家压级，首位玩家升级 |

**性能要求**:
- 出牌响应: <300ms
- 牌局开始: <2秒
- 支持 4 个并发玩家流畅游戏

**技术要求**:
- 游戏状态机用 TypeScript Enum 实现
- 牌型识别算法 (可复用库如 GM.js)
- WebSocket 同步所有玩家状态

---

#### US-4: 游戏币充值与消费

**功能描述**: 用户可充值真实货币购买游戏币，用于支付底注和奖励

##### 4.1 充值流程

**充值选项**:
- [ ] 支付宝 (海外用户)
- [ ] 信用卡 (Stripe)
- [ ] 微信支付 (中国用户)
- [ ] 银行转账 (未来)

**充值套餐**:
```
¥30 → 3,000 游戏币 (100% 购买力)
¥50 → 5,500 游戏币 (110% 购买力) ⭐ 推荐
¥100 → 12,000 游戏币 (120% 购买力)
¥200 → 25,000 游戏币 (125% 购买力)
¥500 → 65,000 游戏币 (130% 购买力)
```

**充值界面需求**:
- [ ] 显示当前游戏币余额
- [ ] 预计到账时间 (通常2-5分钟)
- [ ] 充值优惠提示
- [ ] 支付安全说明
- [ ] 发票选项 (可选)

##### 4.2 消费机制

**游戏币消费场景**:
- 底注支付 (每局消费)
- 购买礼物 (赠送给朋友)
- 商城购买 (头像框、昵称颜色等)
- 参加活动

**最低余额提醒**:
- [ ] 游戏币 < 底注时，弹窗提示充值
- [ ] 显示"快速充值"按钮

**消费明细**:
- [ ] 显示消费记录 (日期、金额、原因)
- [ ] 支持按月/年筛选
- [ ] 导出消费证明

##### 4.3 技术要求

- 集成 Stripe API (信用卡)
- 集成支付宝 API (海外版)
- 订单状态跟踪 (待支付 → 已支付 → 已结算)
- 异常订单处理 (支付失败重试)
- 财务对账机制 (日终对账)

**安全要求**:
- PCI-DSS 合规 (不存储卡信息)
- 使用 Stripe Tokenization
- 所有敏感交易需验证

---

#### US-5: 玩家资料与排行榜

**功能描述**: 用户可查看个人资料、排行榜及好友战绩

##### 5.1 个人资料页

**显示信息**:
- [ ] 昵称、头像、签名
- [ ] 当前等级与经验进度条
- [ ] 总胜率、总局数、连赢记录
- [ ] 当月排名、全球排名
- [ ] 获得的徽章 (见习高手、速战之王等)
- [ ] 好友数量、粉丝数量
- [ ] 最近10局战绩 (时间、对手、输赢、金币)

**可交互操作**:
- [ ] 编辑个人资料 (昵称、签名、头像)
- [ ] 关注/取消关注玩家
- [ ] 举报不良行为
- [ ] 分享个人资料 (生成分享卡片)

##### 5.2 排行榜

**排行榜类型**:

| 排行榜 | 排序条件 | 更新频率 | 显示信息 |
|--------|---------|---------|---------|
| **等级排行** | 玩家等级 > 总局数 | 实时 | 排名、昵称、等级、总局数 |
| **胜率排行** | 胜率 (最少50局) | 小时 | 排名、昵称、胜率、总局数 |
| **月度排行** | 本月赢取金币 | 实时 | 排名、昵称、金币、局数 |
| **全球排行** | 总经验值 | 每日 | 排名、昵称、等级、国家 |

**排行榜功能**:
- [ ] 显示自己的当前排名
- [ ] 点击玩家查看详细资料
- [ ] 搜索特定玩家
- [ ] 地域筛选 (按国家/地区)

##### 5.3 技术实现

- Redis 缓存排行榜数据 (sorted set)
- 每小时更新一次排行
- 支持快速查询玩家排名 (O(log n))

---

#### US-6: 好友管理与私房邀请

**功能描述**: 用户可管理好友，邀请好友进行私房游戏

##### 6.1 好友功能

**好友操作**:
- [ ] 搜索用户 (按昵称/ID)
- [ ] 发送好友请求
- [ ] 接受/拒绝好友请求
- [ ] 删除好友
- [ ] 屏蔽玩家 (不再接收邀请)
- [ ] 备注好友昵称

**好友列表显示**:
- [ ] 在线/离线状态
- [ ] 最后登录时间
- [ ] 最近一次游戏时间
- [ ] 与该好友的战绩

##### 6.2 邀请机制

**邀请流程**:
1. 点击好友 → "发起邀请"
2. 选择房间参数 (底注、局数)
3. 系统生成邀请 (若好友在线，实时通知)
4. 好友点击"接受" → 加入房间
5. 其他玩家匹配或由房主邀请

**邀请通知**:
- [ ] 实时通知 (若在线)
- [ ] 消息记录 (离线消息保留)
- [ ] 邀请过期 (30分钟自动过期)
- [ ] 拒绝邀请选项

---

#### US-7: 游戏内聊天

**功能描述**: 玩家可在游戏中与对手进行有限的文字沟通

**聊天方式**:

##### 7.1 快速表情

- [ ] 预定义表情集 (30+)
  - "太好了！" / "失误了" / "GG" / "再来" 等
- [ ] 一键快速回复 (可在出牌时发送)
- [ ] 表情不支持自定义 (防止骚扰)

##### 7.2 文字聊天 (仅房主房间)

- [ ] 启用/禁用聊天 (房主控制)
- [ ] 聊天框显示在屏幕右侧
- [ ] 最多显示15条最新消息
- [ ] 字数限制: 50字以内
- [ ] 禁用特殊链接/垃圾邮件 (内容审核)
- [ ] 举报恶意消息

**聊天审核**:
- 内容关键词过滤 (违规词汇)
- 垃圾消息检测 (频繁重复)
- 用户举报系统

---

#### US-8: 系统通知与成就徽章

**功能描述**: 系统通知用户游戏事件和成就

##### 8.1 通知类型

| 通知类型 | 示例 | 发送时机 |
|---------|------|---------|
| **游戏邀请** | "玩家A邀请你加入房间1234" | 实时 |
| **成就解锁** | "恭喜解锁成就：速战之王" | 游戏结束 |
| **排名变动** | "你的排名上升到第100名" | 实时 (仅变动) |
| **充值成功** | "充值¥50成功，获得5,500游戏币" | 支付完成 |
| **首次游戏** | "欢迎！完成首局游戏赚取100体验值" | 注册后 |
| **系统维护** | "系统将于明日02:00进行维护" | 提前24小时 |

**通知交付**:
- [ ] 应用内通知 (消息中心)
- [ ] 推送通知 (可配置)
- [ ] 邮件通知 (重要事项)

##### 8.2 成就系统

**成就分类**:

```
🏆 竞技类
  ├─ 首胜 (完成第1局)
  ├─ 十连胜 (连赢10局)
  ├─ 百人斩 (击败100个不同玩家)
  └─ 速战之王 (平均每局时间<3分钟，最少50局)

💰 经济类
  ├─ 小富翁 (累计赚取100,000游戏币)
  ├─ 大富翁 (累计赚取1,000,000游戏币)
  └─ 充值达人 (首次充值)

📈 等级类
  ├─ 升级 (升到2级/3级/10级)
  ├─ 排名冠军 (月度排行第1名)
  └─ 全球前十 (全球排行前10)

🎯 社交类
  ├─ 社交蝴蝶 (添加50个好友)
  ├─ 团队合作 (与同一玩家对战10局)
```

**徽章显示**:
- [ ] 个人资料显示已解锁徽章
- [ ] 排行榜显示徽章标识
- [ ] 徽章可分享 (生成分享卡片)

---

### 2.3 非功能需求

#### 性能需求

| 指标 | 目标 | 说明 |
|------|------|------|
| **首屏加载** | <2秒 | Web 和 Mobile 首屏 |
| **API 响应** | <300ms (P99) | 包括网络往返 |
| **出牌响应** | <100ms | 游戏内关键操作 |
| **游戏帧率** | 60 FPS | 卡牌动画流畅 |
| **并发用户** | 100,000 | 同时在线玩家数 |
| **房间并发** | 10,000 | 同时游戏房间数 |

#### 可用性需求

| 指标 | 目标 | 说明 |
|------|------|------|
| **系统可用性** | 99.5% | 月度可用时间 |
| **故障恢复** | <5分钟 | RTO (恢复时间) |
| **数据恢复** | <1小时 | RPO (恢复点目标) |
| **备份频率** | 每6小时 | 自动备份一次 |

#### 安全需求

| 需求 | 标准 | 实施方案 |
|------|------|---------|
| **数据加密** | TLS 1.3+ | HTTPS + WSS (WebSocket Secure) |
| **密码安全** | bcrypt | rounds=12, 成本因子>10^5 |
| **API 认证** | JWT | 15分钟过期，支持刷新 |
| **交易防护** | PCI-DSS | 不存储卡信息，使用 Tokenization |
| **内容审核** | 关键词过滤 | 实时检测聊天/昵称内容 |
| **反作弊** | 多层检测 | 检查异常胜率/反应时间 |

---

## 3. 用户界面 (UI) 设计

### 3.1 页面架构

```
登录 / 注册
    ↓
大厅 (主菜单)
    ├─ 快速开始 → 匹配房间
    ├─ 创建房间 → 私房设置
    ├─ 好友列表 → 邀请界面
    ├─ 排行榜 → 各类排名
    ├─ 个人资料 → 编辑资料
    ├─ 充值中心 → 选择套餐
    └─ 设置 → 声音/语言等

游戏房间
    ├─ 玩家准备
    ├─ 游戏进行中
    │  ├─ 出牌阶段
    │  ├─ 跟牌阶段
    │  └─ 结算阶段
    └─ 游戏统计
```

### 3.2 关键界面设计要点

#### 3.2.1 登录/注册界面

**设计风格**:
- 中国传统元素 (如麻将纹理背景)
- 温暖的配色 (红色/金色)
- 清晰的 CTA 按钮

**必填元素**:
- [ ] 掼蛋 Logo
- [ ] 简洁的表单 (邮箱/手机号)
- [ ] "快速登录" (第三方 OAuth)
- [ ] 条款同意勾选
- [ ] 错误提示

#### 3.2.2 大厅界面

**布局** (移动优先):
```
╔═══════════════════════╗
║ 用户头像 | 昵称 | 等级 │ (顶部)
╠═══════════════════════╣
║                       │
║ 快速开始 [按钮]       │ (大按钮)
║ 创建房间 [按钮]       │
║                       │
╠═══════════════════════╣
║ 好友列表 (滚动)       │
║ - 玩家A (在线)        │
║ - 玩家B (离线)        │
╠═══════════════════════╣
║ 底部导航              │
║ [大厅] [排行] [我的]  │
╚═══════════════════════╝
```

**关键信息**:
- 当前游戏币余额 (顶部)
- 本月排名 (突出显示)
- 好友在线人数
- 待处理邀请数 (红点提示)

#### 3.2.3 游戏界面

**布局** (关键 - 需优化可用性):
```
┌─────────────────────────────┐
│ 玩家2 (对手1)               │ (上)
│ 剩余手牌: 9 | 已出: XX      │
├─────────────────────────────┤
│ 玩家3 (对手2) | 玩家1       │ (左右)
│ 剩余: 10    | 剩余: 8      │
├─────────────────────────────┤
│         [牌面显示区]         │ (中央)
│      已打出的牌型           │
├─────────────────────────────┤
│ 玩家4 (你)                  │ (下)
│ ♠A ♠K ♠Q ♠J ♠10 ...      │ (手牌)
└─────────────────────────────┘
    [过] [出牌]  (操作按钮)
```

**交互逻辑**:
- [ ] 点击手牌 → 选中/取消
- [ ] 双击手牌 → 快速出牌
- [ ] 长按手牌 → 显示牌型提示
- [ ] 提示按钮 → 推荐出牌组合
- [ ] 倒计时条 → 视觉化时间压力

**其他元素**:
- 游戏币 & 金额显示
- 底注金额
- 回合计数 (本局第几轮)
- 快速表情面板

---

## 4. 技术架构

### 4.1 系统架构图

```
┌────────────────────────────────────────────────┐
│              客户端 (Web/Mobile)                 │
│  ┌──────────────────────────────────────────┐ │
│  │  React / React Native                    │ │
│  │  - UI 组件                               │ │
│  │  - 游戏引擎 (牌型识别、状态管理)        │ │
│  │  - 本地缓存 (Redux/Zustand)            │ │
│  └──────────────────────────────────────────┘ │
└────┬───────────────────────────────────────────┘
     │ HTTPS / WSS
┌────▼───────────────────────────────────────────┐
│          AWS API Gateway                       │
│  ┌──────────────────────────────────────────┐ │
│  │  REST API (认证、用户、支付)             │ │
│  │  WebSocket API (实时游戏)               │ │
│  └──────────────────────────────────────────┘ │
└────┬──────────────┬───────────────────────────┘
     │              │
┌────▼──────┐  ┌────▼───────────┐
│  Lambda   │  │  Lambda         │
│  REST     │  │  (游戏逻辑)    │
│  Handlers │  │  (结算/排名)   │
└────┬──────┘  └────┬───────────┘
     │              │
┌────▼──────────────▼────────────────────────────┐
│          DynamoDB (主数据存储)                 │
│  ┌──────────────────────────────────────────┐ │
│  │  Users (用户账户)                        │ │
│  │  GameSessions (游戏房间状态)            │ │
│  │  GameHistory (历史战绩)                 │ │
│  │  Transactions (交易记录)                │ │
│  │  Leaderboard (排行榜数据)               │ │
│  └──────────────────────────────────────────┘ │
└──────────────────────────────────────────────┘

     ┌─────────────────┐    ┌──────────────┐
     │  Redis Cache    │    │ S3 Storage   │
     │  (排行、会话)  │    │ (头像、日志) │
     └─────────────────┘    └──────────────┘

     ┌──────────────────────────────────────┐
     │  第三方服务                          │
     │  ┌──────────────────────────────────┐│
     │  │ Stripe (信用卡支付)              ││
     │  │ 支付宝 API (海外充值)            ││
     │  │ SendGrid (邮件服务)              ││
     │  │ Sentry (错误监控)                ││
     │  └──────────────────────────────────┘│
     └──────────────────────────────────────┘
```

### 4.2 技术栈选型

| 层级 | 技术 | 原因 |
|------|------|------|
| **前端-Web** | React 18 | 生态成熟、组件库丰富 |
| **前端-Mobile** | React Native | 跨平台代码复用 |
| **后端** | Node.js + Express/Fastify | 实时游戏需要异步支持 |
| **实时通信** | WebSocket + Socket.io | 低延迟、支持降级 |
| **数据库** | DynamoDB | 自动扩展、NoSQL 游戏数据 |
| **缓存** | Redis | 高速读写排行榜/会话 |
| **身份验证** | JWT | 无状态、支持分布式 |
| **支付** | Stripe + 支付宝 SDK | 全球覆盖、安全认证 |
| **监控** | CloudWatch + Sentry | 日志集中、错误追踪 |

### 4.3 数据库设计

#### Users 表

```
PK: userId (UUID)
Attributes:
  - email: String (GSI)
  - phoneNumber: String (可选)
  - nickname: String
  - passwordHash: String (bcrypt)
  - avatarUrl: String
  - signature: String
  - country: String
  - registeredAt: Timestamp
  - lastLoginAt: Timestamp
  - level: Number (1-100)
  - experience: Number
  - totalGames: Number
  - totalWins: Number
  - totalCoins: Number (当前余额)
  - status: Enum (ACTIVE | SUSPENDED | BANNED)
  - kycStatus: Enum (UNVERIFIED | TIER1 | TIER2 | TIER3)
  - createdAt: Timestamp
  - updatedAt: Timestamp
```

#### GameSessions 表

```
PK: sessionId (UUID)
Attributes:
  - gameType: Enum (QUICK_MATCH | PRIVATE_ROOM)
  - roomNumber: String (对于私房)
  - players: List [userId1, userId2, userId3, userId4]
  - status: Enum (WAITING | IN_PROGRESS | FINISHED)
  - initialStake: Number (底注金币)
  - createdAt: Timestamp
  - startedAt: Timestamp (游戏开始时间)
  - finishedAt: Timestamp
  - winner: userId (最终赢家)
  - rankings: Map {userId: rank} (最终排名)
  - coinsDistribution: Map {userId: coins} (每个玩家赢取的金币)
  - ttl: Number (48小时后自动删除)
```

#### GameHistory 表

```
PK: userId
SK: gameSessionId
Attributes:
  - gameType: String
  - opponentIds: List
  - result: Enum (WIN | LOSS | DRAW)
  - coinsEarned: Number
  - experienceGained: Number
  - playedAt: Timestamp
  - duration: Number (分钟)
  - endedAt: Timestamp
  - stats: Object
    - cardsPlayed: Number
    - followCount: Number
    - bonusTurns: Number
```

#### Transactions 表

```
PK: userId
SK: transactionId
Attributes:
  - type: Enum (RECHARGE | SPEND | REWARD | REFUND)
  - amount: Number (游戏币)
  - currency: String (CNY | USD)
  - paymentMethod: String (ALIPAY | STRIPE | WECHAT)
  - relatedGameId: UUID (可选，若为游戏消费)
  - status: Enum (PENDING | SUCCESS | FAILED)
  - createdAt: Timestamp
  - completedAt: Timestamp
  - externalTransactionId: String (支付网关 ID)
```

### 4.4 API 设计概览

#### 认证类 API

```
POST /auth/register
  Request: { email, password, nickname }
  Response: { userId, token, refreshToken }

POST /auth/login
  Request: { email, password }
  Response: { userId, token, refreshToken }

POST /auth/refresh
  Request: { refreshToken }
  Response: { token }

POST /auth/logout
  Request: { token }
  Response: { success }
```

#### 游戏类 API

```
POST /game/quick-match
  Request: {} 
  Response: { sessionId, roomId, opponents }

POST /game/create-room
  Request: { stake, maxGames }
  Response: { roomId, roomCode, joinUrl }

POST /game/join-room
  Request: { roomCode }
  Response: { sessionId, players }

POST /game/play-card
  Request: { sessionId, cards: [Card] }
  Response: { success, nextPlayer, gameState }

POST /game/pass
  Request: { sessionId }
  Response: { success, nextPlayer }
```

#### 充值类 API

```
POST /payment/create-order
  Request: { amount, currency, method }
  Response: { orderId, clientSecret (Stripe) }

POST /payment/confirm
  Request: { orderId, transactionId }
  Response: { success, coins }

GET /payment/orders
  Response: { orders: [Order] }
```

#### 排行榜 API

```
GET /leaderboard/global?page=1&limit=20
  Response: { rankings: [User], myRank }

GET /leaderboard/monthly
  Response: { rankings, myRank }

GET /user/:userId/stats
  Response: { stats: { level, wins, rate, ... } }
```

---

## 5. 上线路线图

### Phase 1A (第1-2月): 核心功能开发

| 周 | 里程碑 | 交付物 |
|----|--------|--------|
| 第1-2周 | 项目启动 + 环境搭建 | Git repo、开发环境、CI/CD 流程 |
| 第3-4周 | 认证系统 | 注册、登录、JWT 验证 |
| 第5-6周 | 游戏引擎 | 牌型识别、游戏状态机 |
| 第7-8周 | 实时通信 | WebSocket 同步、房间管理 |

### Phase 1B (第3月): 支付与社交

| 周 | 里程碑 | 交付物 |
|----|--------|--------|
| 第9-10周 | 支付集成 | Stripe + 支付宝 API、订单管理 |
| 第11-12周 | 好友系统 | 好友管理、邀请机制、排行榜 |
| 第13-14周 | 内容审核 | 关键词过滤、举报系统 |

### Phase 1C (第4-5月): 测试与优化

| 周 | 里程碑 | 交付物 |
|----|--------|--------|
| 第15-16周 | 压力测试 | 支持 100k 并发能力验证 |
| 第17-18周 | 性能优化 | 首屏 <2s、API <300ms |
| 第19-20周 | 灰度发布 | 1% → 10% → 100% 用户 |

---

## 6. 质量保证与测试

### 6.1 测试计划

| 测试类型 | 覆盖率 | 工具 |
|---------|--------|------|
| **单元测试** | 80% (业务逻辑) | Jest |
| **集成测试** | 60% (API 端到端) | Supertest |
| **E2E 测试** | 关键流程 | Playwright / Cypress |
| **性能测试** | 基准测试 | k6 / JMeter |
| **安全测试** | 漏洞扫描 | OWASP ZAP |
| **用户测试** | 5,000+ 测试用户 | Beta 版本 |

### 6.2 缺陷等级定义

| 等级 | 描述 | 示例 | SLA |
|------|------|------|-----|
| **P1** | 阻塞性 | 游戏无法开始、支付失败 | 2小时内修复 |
| **P2** | 严重 | 排行榜错误、匹配失败 | 24小时内修复 |
| **P3** | 中等 | UI 文案错误、性能轻微下降 | 72小时内 |
| **P4** | 低级 | 字体渲染、过时链接 | 下个版本 |

---

## 7. 风险与缓解策略

### 主要风险

| 风险 | 概率 | 影响 | 缓解策略 |
|------|------|------|---------|
| **支付系统故障** | 中 | 高 | 支付超时自动重试、客服人工介入 |
| **游戏掉线** | 中 | 中 | 自动重连机制、游戏恢复 |
| **DDoS 攻击** | 低 | 高 | AWS Shield、API 限流 |
| **数据泄露** | 低 | 极高 | 加密存储、定期安全审计 |
| **用户留存低** | 中 | 高 | A/B 测试、持续优化 UX |

---

## 8. 交付物清单

### 最终交付物 (Phase 1 MVP)

- [ ] Web 版应用 (www.guandan.global)
- [ ] iOS App (App Store)
- [ ] Android App (Google Play)
- [ ] 后端 API (REST + WebSocket)
- [ ] 管理后台 (内部使用)
- [ ] 用户文档 + FAQ
- [ ] 运维文档 (部署、监控、告警)
- [ ] 安全审计报告
- [ ] Beta 测试反馈总结

---

## 9. 成功指标 (KPI)

### 第一个月

- 注册用户: 10万+
- 日活用户 (DAU): 1万+
- 新手留存 (D1): 30%+

### 第三个月

- 注册用户: 30万+
- DAU: 5万+
- 付费率: 5%+
- ARPU: $2-3

### 第五个月 (Phase 1 完成)

- 注册用户: 50万+
- DAU: 10万+ ⭐
- 付费率: 8%+
- ARPU: $5-8
- 月收益: $30-50万
- 月活跃用户 (MAU): 20万+

---

## 10. 法律与合规

### 10.1 用户协议

MVP 版本需包含:
- 游戏规则与责任限制
- 账户使用政策
- 充值与提现条款
- 隐私政策 (GDPR 合规)
- 禁止行为 (作弊、骚扰等)

### 10.2 支付合规

- 支付宝: 需商户认证 (B2C)
- Stripe: PCI-DSS 第二级
- 用户协议需声明: 游戏币仅供娱乐，非真实货币

---

## 11. 发布策略

### 11.1 平台优先级

1. **Web** (第1优先级) - 快速验证、易于迭代
2. **iOS** (第2优先级) - App Store 审核通常需2-3周
3. **Android** (第2优先级) - Google Play 审核需1周

### 11.2 灰度发布

```
第1周: 内部测试 (公司员工)
  ↓
第2周: 小范围 Beta (500 用户，邀请制)
  ↓
第3周: 扩大 Beta (2,000 用户)
  ↓
第4周: 公开发布 (无限制)
```

### 11.3 应急响应

- 若发现重大 Bug (P1)，立即回滚
- 7x24 监控，故障 SLA <15分钟
- Slack / 钉钉 告警通知

---

## 附录 A: 掼蛋游戏规则速查表

| 规则 | 说明 |
|------|------|
| **玩家数** | 4 人 |
| **出牌顺序** | 顺时针 |
| **基础单位** | 最小对子、最小三张 |
| **级数** | 2-A (2 最小，A 最大) |
| **压级** | 末位玩家必须打败当前首位玩家 |
| **升级** | 首位玩家升级 |
| **超时** | 30秒自动过牌 |

---

## 附录 B: 用户旅程地图

```
用户发现 → 注册 → 教程 → 首局游戏 → 充值 → 日常游戏 → 排行 → 邀请好友
  (广告)     (邮箱)   (5分钟)  (获胜)  (买币)  (养成)   (目标)  (保留)
```

---

## 附录 C: 接下来的步骤

1. **技术评审** - 确认技术架构与工期评估
2. **设计稿** - UI/UX 设计稿完成 (高保真原型)
3. **研发启动** - 项目立项、分配资源、定制首周任务
4. **用户研究** - 采访 50+ 潜在用户，验证需求
5. **融资启动** - 准备 Pitch Deck，启动 Seed 融资

---

**文档版本**: v1.0  
**最后更新**: 2025年12月  
**审核人**: 产品负责人、技术负责人  
**状态**: 已批准  
